<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard MCP - BugBusters</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        <aside class="sidebar">
            <div class="logo">
                <h2>MCP <span>BugBusters</span></h2>
            </div>
            <nav>
                <ul>
                    <li class="active" data-target="dash"><i class="bi bi-speedometer2"></i> Dashboard</li>
                    <li data-target="users"><i class="bi bi-people"></i> Técnicos</li>
                    <li data-target="cargos"><i class="bi bi-briefcase"></i> Cargos Internos</li>
                    <li data-target="entidades"><i class="bi bi-building-gear"></i> Entidades / Prioridade</li>
                    <li data-target="config"><i class="bi bi-gear"></i> Configurações</li>
                    <li data-target="glpi"><i class="bi bi-cloud-download"></i> Importar GLPI</li>
                    <li id="btn-logout"><i class="bi bi-box-arrow-right"></i> Sair</li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            
            <header>
                <div class="user-profile">
                    <span class="admin-badge">Admin</span>
                    <div class="avatar"><i class="bi bi-person-circle"></i></div>
                </div>
            </header>

            <section id="dash" class="content-section active">
                <h1>Resumo Geral</h1>
                <div class="cards-grid">
                    <div class="card">
                        <i class="bi bi-person-badge"></i>
                        <div class="info">
                            <h3>Técnicos</h3>
                            <p id="count-users">0</p>
                        </div>
                    </div>
                    <div class="card">
                        <i class="bi bi-tags"></i>
                        <div class="info">
                            <h3>Cargos</h3>
                            <p id="count-cargos">0</p>
                        </div>
                    </div>
                    <div class="card">
                        <i class="bi bi-list-check"></i>
                        <div class="info">
                            <h3>Competências</h3>
                            <p id="count-comp">0</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="users" class="content-section">
                <div class="section-header">
                    <h1>Gestão de Técnicos</h1>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Login GLPI</th>
                                <th>Cargo</th>
                                <th>Telefone</th>
                                <th style="text-align: center;">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="table-users-body"></tbody>
                    </table>
                </div>
            </section>

            <section id="cargos" class="content-section">
                <div class="section-header">
                    <h1>Cargos e Competências</h1>
                    <button class="btn-primary" id="btn-add-cargo"><i class="bi bi-plus-lg"></i> Criar Cargo</button>
                </div>
                <div class="cargos-grid" id="cargos-container"></div>
            </section>

            <section id="entidades" class="content-section">
                <div class="section-header">
                    <h1>Matriz de Prioridade por Entidade</h1>
                    <p>Configure pesos de prioridade para cada cliente vindo do GLPI.</p>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome da Entidade</th>
                                <th style="text-align: center;">Prioridade</th>
                                <th style="text-align: center;">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="table-entidades-body"></tbody>
                    </table>
                </div>
            </section>

            <section id="config" class="content-section">
                <div class="section-header">
                    <h1>Configurações do Sistema</h1>
                    <p>Configure as credenciais de acesso ao GLPI</p>
                </div>
                
                <div class="config-container">
                    <div class="config-card">
                        <h3><i class="bi bi-database-gear"></i> Configurações GLPI</h3>
                        <form id="form-glpi-config">
                            <div class="form-group">
                                <label>URL da API GLPI</label>
                                <input type="url" id="config-glpi-url" placeholder="https://seu-glpi.com/apirest.php" required>
                                <small>URL completa da API do GLPI incluindo /apirest.php</small>
                            </div>
                            
                            <div class="form-group">
                                <label>App Token</label>
                                <input type="text" id="config-glpi-token" placeholder="Token da aplicação" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Login de Usuário</label>
                                <input type="text" id="config-glpi-login" placeholder="Usuario do GLPI" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Senha</label>
                                <div class="password-wrapper">
                                    <input type="password" id="config-glpi-password" placeholder="Senha do usuário" required>
                                    <button type="button" class="toggle-password" onclick="toggleConfigPassword()">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="config-actions">
                                <button type="button" class="btn-secondary" id="btn-test-glpi">
                                    <i class="bi bi-wifi"></i> Testar Conexão
                                </button>
                                <button type="submit" class="btn-primary">
                                    <i class="bi bi-save"></i> Salvar Configurações
                                </button>
                            </div>
                        </form>
                        
                        <div id="config-status" class="config-status" style="display: none;">
                            <i class="bi bi-check-circle"></i>
                            <span></span>
                        </div>
                    </div>
                    
                    <div class="config-card">
                        <h3><i class="bi bi-shield-lock"></i> Alterar Senha</h3>
                        <form id="form-change-password">
                            <div class="form-group">
                                <label>Senha Atual</label>
                                <input type="password" id="current-password" placeholder="Digite sua senha atual" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Nova Senha</label>
                                <input type="password" id="new-password" placeholder="Digite a nova senha" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Confirmar Nova Senha</label>
                                <input type="password" id="confirm-password" placeholder="Confirme a nova senha" required>
                            </div>
                            
                            <button type="submit" class="btn-primary w-100">
                                <i class="bi bi-key"></i> Alterar Senha
                            </button>
                        </form>
                    </div>
                </div>
            </section>

            <section id="glpi" class="content-section">
                <h1>Sincronização GLPI</h1>
                <div class="sync-controls">
                    <button class="btn-secondary" id="sync-competencias">
                        <i class="bi bi-arrow-repeat"></i> Sincronizar Categorias ITIL
                    </button>
                    <p>Última sincronização: <span id="last-sync">--/--/----</span></p>
                </div>
                <div class="table-container">
                    <h3>Consulta em Tempo Real (Técnicos GLPI)</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Entidade</th>
                                <th style="text-align: center;">Ação</th>
                            </tr>
                        </thead>
                        <tbody id="table-glpi-body"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <div id="modal-cargo" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Criar Novo Cargo</h2>
                <span class="close-modal" onclick="closeModal('modal-cargo')">&times;</span>
            </div>
            <form id="form-cargo">
                <div class="form-group">
                    <label>Nome do Cargo</label>
                    <input type="text" id="cargo-nome" placeholder="Ex: Analista N1" required>
                </div>
                <div class="form-group">
                    <label>Descrição</label>
                    <textarea id="cargo-desc" placeholder="Descreva as responsabilidades..."></textarea>
                </div>
                <div class="form-group">
                    <label>Vincular Competências (GLPI)</label>
                    <div id="lista-competencias-select" class="multi-select-box"></div>
                </div>
                <button type="submit" class="btn-primary w-100">Salvar Cargo</button>
            </form>
        </div>
    </div>

    <div id="modal-edit-cargo" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Cargo</h2>
                <span class="close-modal" onclick="closeModal('modal-edit-cargo')">&times;</span>
            </div>
            <form id="form-edit-cargo">
                <input type="hidden" id="edit-cargo-id">
                <div class="form-group">
                    <label>Nome do Cargo</label>
                    <input type="text" id="edit-cargo-nome" required>
                </div>
                <div class="form-group">
                    <label>Descrição</label>
                    <textarea id="edit-cargo-desc"></textarea>
                </div>
                <div class="form-group">
                    <label>Competências Vinculadas</label>
                    <div id="edit-lista-competencias" class="multi-select-box"></div>
                </div>
                <button type="submit" class="btn-primary w-100">Atualizar Dados do Cargo</button>
            </form>
        </div>
    </div>

    <div id="modal-user" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Importar Técnico</h2>
                <span class="close-modal" onclick="closeModal('modal-user')">&times;</span>
            </div>
            <form id="form-user">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="user-nome" readonly class="readonly-input">
                </div>
                <div class="form-group">
                    <label>ID GLPI</label>
                    <input type="text" id="user-id" readonly class="readonly-input">
                </div>
                <div class="form-group">
                    <label>Entidade GLPI</label>
                    <input type="text" id="user-entidade" readonly class="readonly-input">
                </div>
                <div class="form-group">
                    <label>Vincular a um Cargo Interno</label>
                    <select id="user-cargo-select" required></select>
                </div>
                <button type="submit" class="btn-primary w-100">Finalizar Importação</button>
            </form>
        </div>
    </div>

    <div id="modal-edit-user" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Técnico</h2>
                <span class="close-modal" onclick="closeModal('modal-edit-user')">&times;</span>
            </div>
            <form id="form-edit-user">
                <input type="hidden" id="edit-user-id">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="edit-user-nome" required>
                </div>
                <div class="form-group">
                    <label>Telefone / Ramal</label>
                    <input type="text" id="edit-user-telefone" placeholder="(00) 00000-0000">
                </div>
                <div class="form-group">
                    <label>Alterar Cargo</label>
                    <select id="edit-user-cargo-select" required></select>
                </div>
                <button type="submit" class="btn-primary w-100">Atualizar Dados</button>
            </form>
        </div>
    </div>

    <div id="modal-prioridade" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configurar Matriz de Prioridade</h2>
                <span class="close-modal" onclick="closeModal('modal-prioridade')">&times;</span>
            </div>
            <form id="form-prioridade">
                <input type="hidden" id="pri-entidade-id">
                <div class="form-group">
                    <label>Entidade</label>
                    <input type="text" id="pri-entidade-nome" readonly class="readonly-input">
                </div>
                
                <div class="form-group">
                    <label>Prioridade de Atendimento (1 a 5)</label>
                    <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
                        <input type="range" id="pri-valor" min="1" max="5" step="1" value="3" style="flex: 1;">
                        <span id="label-pri-valor" style="font-weight: bold; font-size: 1.2rem; color: #3498db;">3</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #666; margin-top: 5px;">
                        <span>Muito Baixa</span>
                        <span>Baixa</span>
                        <span>Média</span>
                        <span>Alta</span>
                        <span>Crítica</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Configuração da Matriz / Notas</label>
                    <textarea id="pri-matriz-config" placeholder="Ex: Regras de SLA específicas ou detalhes do contrato..."></textarea>
                </div>

                <button type="submit" class="btn-primary w-100">Salvar Prioridade</button>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>